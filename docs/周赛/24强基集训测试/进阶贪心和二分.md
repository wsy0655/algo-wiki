

## é€‰æˆ‘

é”™è¯¯çš„è´ªå¿ƒæ˜¯æŒ‰ç…§ $a_i+b_i$ å‡åºæ’åºã€‚ä¾‹å¦‚ä¸‹é¢ä¾‹å­ã€‚


| $a_i$ | $b_i$ | $a_i+b_i$ | $2a_i+b_i$ |
| :---: | :---: | :-------: | :--------: |
|  $1$  | $100$ |   $101$   |   $102$    |
| $50$  | $50$  |   $100$   |   $150$    |
| $51$  | $49$  |   $100$   |   $151$    |

å¦‚æœæŒ‰ç…§ $a_i+b_i$ ä»å¤§åˆ°å°æ’åºï¼Œéœ€è¦æ¼”è®² $2$ æ¬¡æ‰èƒ½è·èƒœã€‚è€Œåªéœ€è¦å»ç¬¬ä¸‰ä¸ªåœ°æ–¹æ¼”è®²ä¸€æ¬¡å³å¯ç›´æ¥è·èƒœã€‚

èªèªè€å¸ˆçš„ç›®æ ‡æ˜¯ï¼šè®©è‡ªå·±çš„æ€»ç¥¨æ•° **å¤§äº** ç¿è€å¸ˆçš„æ€»ç¥¨æ•°ã€‚

æˆ‘ä»¬å…ˆè®¾ï¼š

- **ä¸æ¼”è®²æ—¶**ï¼Œèªèªè€å¸ˆå¾—ç¥¨ä¸º $0$ï¼ˆå› ä¸ºæ”¯æŒä»–çš„äººä¸æŠ•ç¥¨ï¼‰ï¼Œ  
- ç¿è€å¸ˆå¾—ç¥¨ä¸ºï¼š$\sum a_i$

**æ¯æ¼”è®²ä¸€ä¸ªç‰‡åŒº $i$**ï¼š

- èªèªè€å¸ˆè·å¾—è¯¥ç‰‡åŒºçš„æ‰€æœ‰äººæŠ•ç¥¨ï¼Œå³ï¼š$a_i + b_i$

- ç¿è€å¸ˆå¤±å»è¯¥ç‰‡åŒºåŸæœ¬æ”¯æŒä»–çš„äººï¼Œå³æŸå¤±ï¼š$a_i$

**ğŸ¯ æ‰€ä»¥ï¼Œæ¯æ¼”è®²ä¸€ä¸ªç‰‡åŒº $i$ï¼Œèªèªè€å¸ˆçš„**å‡€æ”¶ç›Š**æ˜¯ï¼š**

$$
\Delta_i = (a_i + b_i) + a_i = 2a_i + b_i
$$

> è§£é‡Šï¼š$a_i + b_i$ï¼šè¯¥ç‰‡åŒºçš„æ‰€æœ‰äººéƒ½æ”¹æŠ•èªèªè€å¸ˆã€‚$a_i$ï¼šè¿™äº›åŸæœ¬æ˜¯æ”¯æŒç¿è€å¸ˆçš„ç¥¨ï¼Œç°åœ¨è½¬è€Œæ”¯æŒèªèªè€å¸ˆï¼Œ**ç­‰äºä»å¯¹æ–¹é˜µè¥ä¸­æŠ¢ç¥¨**ï¼Œå®é™…ä¸Šèªèª **å¤šèµš** äº†è¿™éƒ¨åˆ†ç¥¨

---

**âœ… æ­£ç¡®è´ªå¿ƒç­–ç•¥ï¼š**

å°†æ¯ä¸ªç‰‡åŒºæŒ‰ç…§ $\Delta_i = 2a_i + b_i$ ä»**å¤§åˆ°å°æ’åº**ï¼Œä¾æ¬¡é€‰æ‹©å‘è¡¨æ¼”è®²ï¼Œç›´åˆ°ï¼š

$$
\text{èªèªè€å¸ˆçš„ç¥¨æ•°} > \text{ç¿è€å¸ˆçš„ç¥¨æ•°}
$$

è¿™å°±æ˜¯æœ¬é¢˜æœ€ä¼˜è§£çš„æ ¸å¿ƒé€»è¾‘ã€‚


  
___


## [GESP202503 äº”çº§] å¹³å‡åˆ†é…



**âœ… æ­£ç¡®è§£æ³•æ€è·¯ï¼ˆè´ªå¿ƒï¼‰**

- ç¬¬ä¸€æ­¥ï¼š**å‡è®¾æ‰€æœ‰ç‰©å“éƒ½å–ç»™ B**
    - åˆå§‹æ€»æ”¶å…¥ä¸ºï¼š$\text{sum} = \sum\limits_{i=1}^{2n} b_i$


- ç¬¬äºŒæ­¥ï¼š**ä»ä¸­æŒ‘å‡º $n$ ä»¶é€€è¿˜ç»™ Cï¼ˆä¹Ÿå°±æ˜¯å–ç»™ Cï¼‰**
    - å¯¹äºæ¯ä»¶ç‰©å“ï¼Œè®¡ç®— å¦‚æœå–ç»™ C è€Œä¸æ˜¯ Bï¼Œå¤šèµšï¼ˆæˆ–å°‘äºï¼‰å¤šå°‘é’±ï¼š$\delta_i = c_i - b_i$

- é€‰æ‹© $n$ ä¸ªæœ€å¤§çš„ $\delta_i$ï¼Œä¹Ÿå°±æ˜¯æ”¶ç›Šä» B è½¬åˆ° C åå¢ç›Šæœ€å¤§çš„ $n$ ä»¶ç‰©å“

- ç¬¬ä¸‰æ­¥ï¼š**æ€»æ”¶å…¥ä¸º**

$$
\text{ans} = \sum b_i + \sum_{\text{top n}} (c_i - b_i)
$$


  
___



## åŒºé—´è´ªå¿ƒæ¨¡å‹


### æ¨¡å‹ä¸€ï¼šçº¿æ®µè¦†ç›–æ¨¡å‹

**é¢˜æ„ï¼š** ç»™å®š $n$ ä¸ªåŒºé—´ï¼Œæœ€å¤šå¯ä»¥é€‰æ‹©å¤šå°‘ä¸ªæ²¡æœ‰é‡å çš„åŒºé—´ã€‚


**è§£é¢˜æ€è·¯ï¼š** 

- æŒ‰ç…§å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºã€‚
    - è´ªå¿ƒé€‰æ‹©åŒºé—´ï¼Œæ¯æ¬¡é€‰æ‹©å³ç«¯ç‚¹æœ€å°çš„åŒºé—´ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦ä¸å·²é€‰æ‹©çš„åŒºé—´æœ‰é‡å ã€‚
    - å¦‚æœæœ‰é‡å ï¼Œåˆ™ä¸èƒ½é€‰æ‹©è¯¥åŒºé—´ã€‚
- å…·ä½“æ¥è¯´ï¼šç»´æŠ¤ä¸Šä¸€ä¸ªé€‰æ‹©çš„åŒºé—´çš„å³ç«¯ç‚¹æ•°å€¼ `endr`ã€‚
    - è‹¥å½“å‰åŒºé—´ `a[i].l > endr` è¯´æ˜æ²¡æœ‰äº¤é›†ã€‚å¯ä»¥é€‰æ‹©ã€‚
    - å¦åˆ™æ— æ³•é€‰æ‹©ã€‚
- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log n)$

  
___


### æ¨¡å‹äºŒï¼šæœ€å°‘ç‚¹è¦†ç›–


**é¢˜æ„ï¼š** ç»™å®š $n$ ä¸ªåŒºé—´ å’Œä¸€æ¡æ— é™é•¿çš„æ•°è½´ã€‚è¦æ±‚åœ¨æ•°è½´ä¸Šé€‰æ‹©è‹¥å¹²ä¸ªç‚¹ï¼Œä½¿å¾—æ¯ä¸ªåŒºé—´è‡³å°‘æœ‰ä¸€ä¸ªç‚¹è¢«é€‰ä¸­ã€‚æ±‚æœ€å°‘é€‰æ‹©å‡ ä¸ªç‚¹ã€‚


**è§£é¢˜æ€è·¯ï¼š** 


- æŒ‰ç…§åŒºé—´çš„å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºã€‚
    - åœ¨å½“å‰åŒºé—´å†…éšä¾¿é€‰ä¸€ä¸ªç‚¹éƒ½èƒ½è¦†ç›–å½“å‰åŒºé—´ã€‚
    - ä¸ºäº†å‡å°‘åç»­çš„é€‰æ‹©ï¼Œåº”å½“æŠŠç‚¹é€‰æ‹©åˆ°åŒºé—´çš„å³ç«¯ç‚¹å¤„ï¼Œè¿™æ ·å°½å¯èƒ½ç…§é¡¾åˆ°åé¢çš„åŒºé—´ã€‚
- ç»´æŠ¤ä¸€ä¸ª `endr`ï¼Œè®°å½•ä¸Šä¸€ä¸ªé€‰æ‹©çš„ç‚¹çš„ä½ç½®ã€‚
    - è‹¥ `a[i].l > endr` è¯´æ˜å½“å‰åŒºé—´æ²¡æœ‰è¢«è¦†ç›–åˆ°ã€‚
      - æ›´æ–° `endr = a[i].r`ã€‚åŒæ—¶ `sum++` ç›¸å½“äºé€‰æ‹©äº†ä¸€ä¸ªç‚¹ã€‚
- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log n)$


**[ABC230D] Destroyer Takahashi**


æœ¬é¢˜ç›¸å½“äºä¸€æ¬¡æ€§é€‰æ‹©ä¸€ä¸ªé•¿åº¦ä¸º $D$ çš„åŒºé—´æ¥è¦†ç›–ç›®å‰è¿™äº›åŒºé—´ï¼Œä½¿å¾—æ¯ä¸ªåŒºé—´éƒ½è¢«è¦†ç›–è¿‡ã€‚å’Œæ¨¡å‹äºŒç±»ä¼¼ï¼ŒæŒ‰ç…§å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ª `endr`ï¼Œè®°å½•ä¸Šä¸€ä¸ªé€‰æ‹©çš„ç‚¹ä½ç½®ã€‚


æ³¨æ„æ›´æ–° `endr = a[i].r + D - 1` ç›¸å½“äºé€‰æ‹©çš„æœ€è¿œçš„ç‚¹å† `a[i].r + D - 1` è¿™ä¸ªä½ç½®ã€‚
  
___

### å…¶ä½™å¸¸è§æ¨¡å‹

[çŸ¥ä¹](https://zhuanlan.zhihu.com/p/672289211)
  
___

### ç®€å•ä¾‹é¢˜

#### ä¸€ï¼šåºåˆ—

**é¢˜æ„ï¼š** ç»™å®š $n$ ä¸ªåŒºé—´ï¼Œè¦æ±‚æ¯ä¸ªåŒºé—´è‡³å°‘æœ‰ $c$ ä¸ªç‚¹ï¼Œé—®ä½ æœ€å°‘éœ€è¦å¤šå°‘ä¸ªç‚¹ã€‚


**è§£é¢˜æ€è·¯ï¼š** 

- æŒ‰ç…§å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºã€‚
- ä½¿ç”¨ä¸€ä¸ª `vis` æ•°ç»„æ‰“æ ‡è®°ï¼Œæ ‡è®°å·²ç»é€‰æ‹©çš„ç‚¹çš„ä½ç½®ã€‚
- éå†æ‰€æœ‰åŒºé—´ `[l, r, c]`ã€‚
    - é¦–å…ˆç»Ÿè®¡å½“å‰åŒºé—´å†… `vis` å€¼ä¸º $1$ çš„ä¸ªæ•°ï¼Œè®°ä¸º `cnt`ã€‚
    - è‹¥ `cnt >= c` è¯´æ˜å½“å‰åŒºé—´å†…å·²ç»æœ‰ `c` ä¸ªç‚¹ï¼Œä¸éœ€è¦é€‰æ‹©ã€‚
    - å¦åˆ™ï¼Œé€‰æ‹© `c - cnt` ä¸ªç‚¹ï¼Œå¹¶æ›´æ–° `vis` æ•°ç»„ã€‚
      - å€’åºéå†å½“å‰åŒºé—´ï¼Œå°†ç‚¹é€‰æ‹©å°½é‡é å³çš„ä½ç½®ã€‚ä»¥ä½¿å¾—ç…§é¡¾å°½é‡é åçš„ä½ç½®ã€‚
  
___
  
#### äºŒï¼šé›·è¾¾å®‰è£…

é’ˆå¯¹æ¯ä¸ªå²›å±¿å¯ä»¥ä½¿ç”¨å‹¾è‚¡å®šç†æ±‚å‡º $x$ è½´ä¸Šæœ€å³è¾¹çš„é›·è¾¾ä½ç½® $r$ ä»¥åŠæœ€å·¦è¾¹çš„é›·è¾¾ä½ç½® $l$ã€‚

- åˆ™åœ¨åŒºé—´ $[l,r]$ éšä¾¿é€‰æ‹©ä¸€ä¸ªç‚¹éƒ½å¯ä»¥è¦†ç›–åˆ°å½“å‰å²›å±¿ã€‚


é‚£ä¹ˆé—®é¢˜å°±æ˜¯æœ‰ $n$ ä¸ª $[l,r]$ åŒºé—´ï¼Œæœ€å°‘é€‰æ‹©å‡ ä¸ªç‚¹ä½¿å¾—æ¯ä¸ªåŒºé—´éƒ½è‡³å°‘æœ‰ä¸€ä¸ªç‚¹ã€‚
  
___

#### ä¸‰ï¼š[CSP-S 2024] è¶…é€Ÿæ£€æµ‹

åŸºæœ¬æ–¹å‘ï¼šæŒ‰ç…§ $a_i$ çš„å€¼åˆ†ä¸‰ç§æƒ…å†µã€‚$>0,=0,<0$ã€‚


- $a_i=0$ï¼Œé€Ÿåº¦æ’å®šä¸å˜ã€‚å› æ­¤åˆå§‹é€Ÿåº¦ $v_i>V$ åˆ™è¶…é€Ÿã€‚
    - æ˜¯å¦ä¼šè¢«æ‘„åƒå¤´æ‹åˆ°ï¼Ÿ
    - ç­‰ä»·äºæ±‚è§£æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ‘„åƒå¤´ï¼Œå…¶ä½ç½® $\geq d_i$ã€‚
        - å¯ä»¥äºŒåˆ† `lower_bound`ã€‚

```cpp
if (a[i] == 0) // é€Ÿåº¦ä¸å˜
{
    if (v[i] > V) // åˆå§‹é€Ÿåº¦å¿…é¡»å¤§äºé™é€Ÿ
    {
        int l = lower_bound(p + 1, p + m + 1, d[i]) - p;
        if (l != m + 1) // ä¼šè¢«æ‹åˆ°
        {
            ans++;
        } 
    } 	
}
```

___


- $a_i>0$ã€‚
    - è‹¥åˆå§‹ $v_i>V$ åˆå§‹å°±è¶…é€Ÿï¼Œåˆ™ç­‰åŒäº $a_i=0$ã€‚
    - è‹¥ $v_i\leq V$ï¼Œåˆ™å‰è¿›äº†ä¸€æ®µè·ç¦» $s$ ä»¥åæ‰è¶…é€Ÿã€‚æ±‚å‡ºå‰è¿‘è·ç¦» $s$ï¼Œç„¶åç­‰åŒäºæ±‚è§£ $d_i+s\leq L$ æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ‘„åƒå¤´ã€‚

æ ¹æ®é¢˜ç›®ç»™çš„å…¬å¼ $s=\dfrac{V^2-v_i^2}{2a_i}$ ï¼Œå¯ä»¥å¾—åˆ°å½“ $s> \dfrac{V^2-v_i^2}{a_i}$ ä¼šè¶…é€Ÿã€‚


ç”±äºæ‘„åƒå¤´éƒ½åœ¨æ•´æ•°ä½ç½®ï¼Œå› æ­¤ $s$ åº”è¯¥å– $\left\lfloor\dfrac{V^2-v_i^2}{a_i}\right\rfloor+1$ã€‚

ä¾‹å¦‚ï¼š

- $s=3.5$ï¼Œä¸‹å–æ•´ä»¥åä¸º $3$ï¼Œç„¶ååŠ  $1$ å¾—åˆ° $4$ã€‚
- $s=3$ï¼Œä¸‹å–æ•´ä»¥åä¸º $3$ï¼Œç„¶ååŠ  $1$ ä»ç„¶å¾—åˆ° $4$ã€‚


```cpp
if (a[i] > 0)
{
    if (v[i] > V) // è¶…é€Ÿ
    {
        int j = lower_bound(p + 1, p + m + 1, d[i]) - p;
        if (j != m + 1) // è¯´æ˜å¯ä»¥è¢« [j, m] éƒ½æ‹ä¸€æ¬¡ 
        {
            ans++;
        } 
    }
    else
    {
        int s = (V * V - v[i] * v[i]) / (2 * a[i]) + 1;
        int j = lower_bound(p + 1, p + m + 1, d[i] + s) - p;
        if (j != m + 1) // è¯´æ˜å¯ä»¥è¢« [j, m] éƒ½æ‹ä¸€æ¬¡ 
        {
            ans++;
        }  
    } 
}
```

___

- $a_i<0$ï¼š
    - è‹¥ $v_i\leq V$ï¼Œåˆ™æ°¸è¿œä¸è¶…é€Ÿä¸å¿…è€ƒè™‘ã€‚
    - åä¹‹ï¼Œè¶…é€Ÿäº†ä¸€æ®µè·ç¦» $s$ ä»¥åé€Ÿåº¦é™äº†ä¸‹æ¥ã€‚
    - å› æ­¤éœ€è¦æ±‚å‡ºå‰è¿›è·ç¦» $s$ï¼Œæ»¡è¶³ $[d,d+s]$ éƒ½æ˜¯è¶…é€Ÿçš„ã€‚ç„¶ååˆ¤æ–­è¿™ä¸ªèŒƒå›´æ˜¯å¦å­˜åœ¨æ‘„åƒå¤´å³å¯ã€‚

æ ¹æ®é¢˜ç›®ç»™çš„å…¬å¼ $s=\dfrac{V^2-v_i^2}{2a_i}$ ï¼Œå¯ä»¥å¾—åˆ°å½“ $s< \dfrac{V^2-v_i^2}{a_i}$ ä¼šè¶…é€Ÿã€‚

ç”±äºæ‘„åƒå¤´å‡åœ¨æ•´æ•°ä½ç½®ï¼Œå› æ­¤ $s$ åº”è¯¥å– $\lceil\dfrac{V^2-v_i^2}{a_i}-1\rceil$ã€‚

ä¾‹å¦‚ï¼š

- $s=3.5$ï¼Œå®é™…å‰è¿› $3$ ä»¥å†…éƒ½æ˜¯è¶…é€Ÿçš„ï¼Œå› æ­¤æ‘„åƒå¤´åº”è¯¥åœ¨ $[d,d+3]$ ä¹‹é—´ã€‚
- $s=3$ï¼Œå®é™…å‰è¿› $2$ ä»¥å†…éƒ½æ˜¯è¶…é€Ÿçš„ï¼Œå› æ­¤æ‘„åƒå¤´åº”è¯¥åœ¨ $[d,d+2]$ ä¹‹é—´ã€‚

å…·ä½“å®ç°ä¹Ÿå¯ä»¥ï¼š


- è®° `up = V * V - v[i] * v[i]`ï¼Œ`down = 2 * a[i]`ã€‚
- ä»¤ `s = up / down`ã€‚ç”±äºç»“æœå¿…ç„¶éè´Ÿï¼Œç›¸å½“äºä¸‹å–æ•´ã€‚
- è‹¥ `up % down == 0`ï¼Œç»™ $s$ å‡å» $1$ å³å¯ã€‚

```cpp
if (a[i] < 0)
{
    if (v[i] > V) // åˆå§‹è¶…é€Ÿæ‰æœ‰å¯èƒ½è¢«æŠ“åˆ°
    {
        int up = V * V - v[i] * v[i], down = 2 * a[i];
        int s = up / down;
        if (up % down == 0) s -= 1;
        // éªŒè¯ [d, d + s] ä»¥å†…æœ‰æ— æ‘„åƒå¤´ 
        int l = lower_bound(p + 1, p + m + 1, d[i]) - p;
        if (l != m + 1)
        {
            // äºŒåˆ†æœ€åä¸€ä¸ªå°äºç­‰äº d[i] + s çš„æ‘„åƒå¤´ç¼–å·è®°ä½œ r 
            int r = upper_bound(p + 1, p + m + 1, d[i] + s) - p - 1;
            if (l <= r)
            {
                ans++;
            } 
        }
    } 
}
```

___


**å†æ¥çœ‹ç¬¬äºŒé—®**

æ±‚è§£æœ€å¤šå…³é—­ä¸ªæ•°ç­‰äºåŒäºæ€»æ•°å‡å»æœ€å°‘å¼€å¯æ•°é‡ã€‚


æ³¨æ„åˆ°ï¼šæ¯è¾†è½¦éƒ½å¯¹åº”ä¸€ä¸ªæ‘„åƒå¤´åŒºé—´ï¼Œåªè¦åœ¨è¯¥åŒºé—´å†…çš„ä»»æ„ä¸€ä¸ªæ‘„åƒå¤´å‡å¯æ‹åˆ°è¯¥è½¦è¶…é€Ÿã€‚

- ä¾‹å¦‚å½“ $a_i=0$ æ—¶ï¼Œç¬¬ä¸€ä¸ªæ‘„åƒå¤´ $j$ å¯ä»¥æ‹åˆ°ï¼Œåˆ™ $[j,m]$ çš„æ‘„åƒå¤´ä¹Ÿéƒ½å¯ä»¥æ‹åˆ°ã€‚


é—®é¢˜ç­‰ä»·äºï¼šç»™å®šè‹¥å¹²ä¸ªåŒºé—´ $[l,r]$ï¼Œæ¯ä¸ªåŒºé—´è‡³å°‘æœ‰ä¸€ä¸ªç‚¹ï¼ˆæ‘„åƒå¤´ï¼‰ï¼Œé—®è‡³å°‘é€‰æ‹©å‡ ä¸ªç‚¹ã€‚


æ˜¾ç„¶å°±æ˜¯æœ€å°‘ç‚¹è¦†ç›–æ¨¡å‹äº†ï¼ŒæŒ‰ç…§å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºè´ªå¿ƒå³å¯ã€‚


æœ€ç»ˆæ•´ä½“å¤æ‚åº¦ä¸º $O(n\log{m})$ã€‚

**å®Œæ•´ä»£ç **

```cpp
#include <bits/stdc++.h>
using namespace std;
constexpr int N = 1e5 + 5;
int n, m, L, V, d[N], v[N], a[N], p[N];
struct node 
{
    int l, r;
};
bool cmp(node x, node y) 
{
    return x.r < y.r; 
}
void solve()
{
    // æšä¸¾æ‰€æœ‰çš„è½¦ï¼Œæ£€éªŒæ˜¯å¦è¶…é€Ÿ 
    int ans = 0;
    vector<node> segs;
    for (int i = 1; i <= n; i++) 
    {
        if (a[i] == 0)
        {
            if (v[i] > V) // è¶…é€Ÿ
            {
                int j = lower_bound(p + 1, p + m + 1, d[i]) - p;
                if (j != m + 1) // è¯´æ˜å¯ä»¥è¢« [j, m] éƒ½æ‹ä¸€æ¬¡ 
                {
                    ans++;
                    segs.push_back({j, m});
                } 
            } 
        }
        if (a[i] > 0)
        {
            if (v[i] > V) // è¶…é€Ÿ
            {
                int j = lower_bound(p + 1, p + m + 1, d[i]) - p;
                if (j != m + 1) // è¯´æ˜å¯ä»¥è¢« [j, m] éƒ½æ‹ä¸€æ¬¡ 
                {
                    ans++;
                    segs.push_back({j, m});
                } 
            }
            else
            {
                int s = (V * V - v[i] * v[i]) / (2 * a[i]) + 1;
                int j = lower_bound(p + 1, p + m + 1, d[i] + s) - p;
                if (j != m + 1) // è¯´æ˜å¯ä»¥è¢« [j, m] éƒ½æ‹ä¸€æ¬¡ 
                {
                    ans++;
                    segs.push_back({j, m});
                }  
            } 
        }
        if (a[i] < 0)
        {
            if (v[i] > V)
            {
                int up = abs(V * V - v[i] * v[i]), down = abs(2 * a[i]);
                int s = up / down;
                if (up % down == 0) s -= 1;
                // éªŒè¯ [d, d + s] ä»¥å†…æœ‰æ— æ‘„åƒå¤´ 
                int l = lower_bound(p + 1, p + m + 1, d[i]) - p;
                if (l != m + 1)
                {
                    // äºŒåˆ†æœ€åä¸€ä¸ªå°äºç­‰äº d[i] + s çš„æ‘„åƒå¤´ç¼–å·è®°ä½œ r 
                    int r = upper_bound(p + 1, p + m + 1, d[i] + s) - p - 1;
                    if (l <= r)
                    {
                        ans++;
                        segs.push_back({l, r});
                    } 
                }
            } 
        }
    }
    cout << ans << " ";
    int endr = -1, sum = 0;
    sort(segs.begin(), segs.end(), cmp);
    for (auto it : segs)
    {
        if (it.l > endr)
        {
            endr = it.r;
            sum++;
        }
    }
    cout << m - sum << "\n"; 
}
int main()
{
    ios::sync_with_stdio(false), cin.tie(0);
    int t;
    cin >> t;
    while (t--) 
    {
        cin >> n >> m >> L >> V;
        for (int i = 1; i <= n; i++) cin >> d[i] >> v[i] >> a[i];
        for (int i = 1; i <= m; i++) cin >> p[i];
        solve(); 
    }
    return 0;
}
```


___

## é‚»é¡¹äº¤æ¢æ³•


å®ƒæ˜¯ä¸€ç§å¸¸è§çš„äº¤æ¢è®ºè¯æŠ€å·§ï¼Œæœ¬è´¨æ˜¯ï¼š

- é€šè¿‡äº¤æ¢ä¸¤ä¸ªå±€éƒ¨é€‰æ‹©çš„é¡ºåºï¼Œæ¥è¯æ˜æŸç§è´ªå¿ƒç­–ç•¥æ˜¯æœ€ä¼˜çš„ã€‚

**ä¸¾ä¸ªä¾‹å­ï¼š** æœ‰ $n$ ä¸ªä»»åŠ¡ï¼Œç¬¬ $i$ ä¸ªä»»åŠ¡åŠ å·¥æ—¶é—´æ˜¯ $t_i$ã€‚ä½ è¦å®‰æ’è¿™äº›ä»»åŠ¡é¡ºåºï¼Œä½¿å¾— æ‰€æœ‰ä»»åŠ¡çš„æ€»ç­‰å¾…æ—¶é—´ä¹‹å’Œæœ€å°ã€‚


**è´ªå¿ƒç­–ç•¥ï¼š** æŒ‰ç…§åŠ å·¥æ—¶é—´ $t_i$ ä»å°åˆ°å¤§çš„é¡ºåºå®‰æ’ä»»åŠ¡ã€‚


**è¯æ˜ï¼š** 

å‡è®¾å½“å‰æ’äº†æŸä¸¤ä¸ªä»»åŠ¡ $i,j$ï¼Œå…¶ä¸­ $t_i>t_j$ã€‚

è‹¥ $i$ åœ¨ $j$ å‰é¢ã€‚æ­¤æ—¶ç­‰å¾…æ—¶é—´ä¸ºï¼š

- $i$ ç­‰å¾… $W$ã€‚$j$ ç­‰å¾… $W+t_i$ã€‚
    - å…¶ä¸­ $W$ æŒ‡ $i$ ä¹‹å‰ä»»åŠ¡çš„ç­‰å¾…æ€»æ—¶é—´ã€‚
- åˆè®¡ç­‰å¾…æ—¶é—´ä¸º $2W+t_i$ã€‚

è‹¥ $j$ åœ¨ $i$ å‰é¢ã€‚æ­¤æ—¶ç­‰å¾…æ—¶é—´ä¸ºï¼š

- $j$ ç­‰å¾… $W$ã€‚$i$ ç­‰å¾… $W+t_j$ã€‚

- åˆè®¡ç­‰å¾…æ—¶é—´ä¸º $2W+t_j$ã€‚

æ˜¾ç„¶ï¼Œ$2W+t_i>2W+t_j$ã€‚

æ‰€ä»¥æœ€ä¼˜ç­–ç•¥æ˜¯ï¼šæŠŠå¤„ç†æ—¶é—´çŸ­çš„ä»»åŠ¡æ’åœ¨å‰é¢ã€‚

___

### ä¾‹é¢˜ä¸€ï¼š[USACO05NOV] å¥¶ç‰›ç©æ‚æŠ€


è®¾å½“å‰å‰ $i-1$ å¤´ç‰›çš„é‡é‡å’Œä¸º $sum$ã€‚

**è‹¥ $i$ åœ¨ $j$ ä¹‹å‰ï¼š**

* å¯¹äº $j$ çš„å‹æ‰ç¨‹åº¦ä¸ºï¼š$sum + w_i - s_j$
* å¯¹äº $i$ çš„å‹æ‰ç¨‹åº¦ä¸ºï¼š$sum - s_i$
* æœ€å¤§å‹æ‰ç¨‹åº¦ä¸ºï¼š$\max(sum - s_i, sum + w_i - s_j)$

**è‹¥ $j$ åœ¨ $i$ ä¹‹å‰ï¼š**

* å¯¹äº $i$ çš„å‹æ‰ç¨‹åº¦ä¸ºï¼š$sum + w_j - s_i$
* å¯¹äº $j$ çš„å‹æ‰ç¨‹åº¦ä¸ºï¼š$sum - s_j$
* æœ€å¤§å‹æ‰ç¨‹åº¦ä¸ºï¼š$\max(sum - s_j, sum + w_j - s_i)$

---

**æ¨å¯¼æ¯”è¾ƒ**

ä¸ºäº†ä½¿æ€»å‹æ‰ç¨‹åº¦æ›´å°ï¼Œå¸Œæœ›æ»¡è¶³ï¼š

$$
\max(sum - s_i, sum + w_i - s_j) < \max(sum - s_j, sum + w_j - s_i)
$$

è®°ï¼š

* $1 = sum - s_i$
* $2 = sum + w_i - s_j$
* $3 = sum - s_j$
* $4 = sum + w_j - s_i$

æ¥ä¸‹æ¥åˆ†ç±»è®¨è®ºå·¦å³ä¸¤è¾¹ $\max$ å–åˆ°çš„é¡¹ã€‚

---


- è‹¥å·¦è¾¹å– $1$ï¼Œå³è¾¹å– $3$ï¼š

$1 < 3 \quad \Rightarrow \quad sum - s_i < sum - s_j$

æ˜¾ç„¶æ’æˆç«‹ï¼Œå› ä¸º $s_i > s_j$ å¯¼è‡´ $sum - s_i < sum - s_j$ã€‚

- è‹¥å·¦è¾¹å– $1$ï¼Œå³è¾¹å– $4$ï¼š

$1 < 4 \quad \Rightarrow \quad sum - s_i < sum + w_j - s_i$
æ’æˆç«‹ï¼Œå› ä¸º $w_j > 0$ã€‚

---

- è‹¥å·¦è¾¹å– $2$ï¼Œå³è¾¹å– $3$ï¼š

$2 < 3 \quad \Rightarrow \quad sum + w_i - s_j < sum - s_j$
è¿™ä¸å¯èƒ½æˆç«‹ï¼Œå› ä¸º $w_i > 0$ã€‚

- è‹¥å·¦è¾¹å– $2$ï¼Œå³è¾¹å– $4$ï¼š

$2 < 4 \quad \Rightarrow \quad sum + w_i - s_j < sum + w_j - s_i$
åŒ–ç®€å¾—ï¼š
$w_i + s_i < w_j + s_j$

å› æ­¤ï¼Œåº”æŒ‰ç…§ $w + s$ ä»å°åˆ°å¤§æ’åºã€‚



---


### ä¾‹é¢˜äºŒï¼š[ABC268F] Best Concatenation


**é¢˜æ„æ¦‚è¿°**

æœ‰ $n$ ä¸ªå­—ç¬¦ä¸² $s_1,s_2,\ldots,s_n$ã€‚æ‰¾åˆ°æœ€ä¼˜é¡ºåºå°† $n$ ä¸ªå­—ç¬¦ä¸²æ‹¼èµ·æ¥å¹¶ä½¿å¾—æ€»å¾—åˆ†æœ€å¤§ã€‚

**å¾—åˆ†è§„åˆ™ï¼š**

* éå†æœ€ç»ˆçš„å­—ç¬¦ä¸² $S$ï¼Œè‹¥ $S[i]$ ä¸ºæ•°å­—å­—ç¬¦ï¼Œå¼€å§‹è®¡ç®—å¾—åˆ†ã€‚
* è¯¥å¾—åˆ†ä¸ºï¼š$S[i]\$ å¯¹åº”çš„æ•°å­— **ä¹˜ä»¥** ä»å¤´å¼€å§‹åˆ°å½“å‰ä½ç½®å­—ç¬¦ `X` çš„ä¸ªæ•°ã€‚
* ç´¯åŠ æ‰€æœ‰å¾—åˆ†å³ä¸ºæ€»å¾—åˆ†ã€‚

æ•°æ®èŒƒå›´ï¼š$n \le 2 \times 10^5$

---

**è§£é¢˜æ€è·¯ï¼ˆä¸€ï¼‰ï¼šé‚»é¡¹äº¤æ¢æ³•ä»‹ç»**

ä½¿ç”¨è´ªå¿ƒ + é‚»é¡¹äº¤æ¢æ³•ï¼šæˆ‘ä»¬è¦å†³å®šä¸¤ä¸ªå­—ç¬¦ä¸² $s_i$ å’Œ $s_j$ çš„å…ˆåé¡ºåºæ˜¯å¦å½±å“æœ€ç»ˆå¾—åˆ†ã€‚

å®šä¹‰æ¯ä¸ªå­—ç¬¦ä¸² $s_i$ çš„ä¸‰ä¸ªå…³é”®é‡ï¼š

* $x_i$ï¼šå­—ç¬¦ä¸²ä¸­å­—ç¬¦ `X` çš„æ•°é‡
* $d_i$ï¼šæ•°å­—å­—ç¬¦çš„æ€»å’Œï¼ˆè´¡çŒ®å› å­ï¼‰
* $\text{score}_i$ï¼š$s_i$ å†…éƒ¨è‡ªå¸¦çš„å¾—åˆ†ï¼ˆæ•°å­—å­—ç¬¦å’Œ **ä¹˜ä»¥** å½“å‰å·²æœ‰çš„ `X` æ•°ï¼‰

å‡è®¾å½“å‰å·²æœ‰ $sum_x$ ä¸ª `X`ï¼Œè‹¥æ‹¼æ¥é¡ºåºä¸º $s_i$ åœ¨å‰ã€$s_j$ åœ¨åï¼Œè®¡ç®—å…¶é¢å¤–è´¡çŒ®ã€‚

---

**è§£é¢˜æ€è·¯ï¼ˆäºŒï¼‰ï¼šæ’åºä¸ç­‰å¼æ¨å¯¼**

* $s_i$ åœ¨ $s_j$ ä¹‹å‰çš„é¢å¤–è´¡çŒ®ä¸ºï¼š
  $d_i \cdot sum_x + d_j \cdot (sum_x + x_i)$

* $s_j$ åœ¨ $s_i$ ä¹‹å‰çš„é¢å¤–è´¡çŒ®ä¸ºï¼š
  $d_j \cdot sum_x + d_i \cdot (sum_x + x_j)$

* ä¸¤è€…å·®å€¼ä¸ºï¼š
  $d_j \cdot x_i - d_i \cdot x_j$

è‹¥å¸Œæœ› $s_i\$ åœ¨ $s_j$ å‰æ›´ä¼˜ï¼Œåº”æ»¡è¶³ï¼š
$x_i \cdot d_j > x_j \cdot d_i$

**æ’åºç­–ç•¥**ï¼šæŒ‰ç…§ $(x_i, d_i)$ å¯¹ï¼Œæ¯å¯¹å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶åº”ç”¨ä¸Šè¿°äº¤å‰ä¹˜æ’åºè§„åˆ™ã€‚

---

**å…·ä½“å®ç°æ­¥éª¤**

- éå†æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œé¢„å¤„ç†å‡ºï¼š

     - å†…éƒ¨å¾—åˆ† $\text{score}_i$
     - $x_i$ï¼ˆå­—ç¬¦ `X` æ•°é‡ï¼‰
     - $d_i$ï¼ˆæ•°å­—å­—ç¬¦å’Œï¼‰

- å°†å­—ç¬¦ä¸²å°è£…ä¸ºç»“æ„ä½“ï¼ŒæŒ‰ç…§ $x_i \cdot d_j > x_j \cdot d_i$ çš„é¡ºåºæ’åºã€‚

- æ’åºåæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œé€å­—ç¬¦æ‰«æï¼Œè®¡ç®—æœ€ç»ˆå¾—åˆ†ã€‚

**æ—¶é—´å¤æ‚åº¦ï¼š** $O(n \log n + \text{æ€»å­—ç¬¦æ•°})$

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
constexpr int N = 2e5 + 5;
int n;
struct node
{
    ll x, d, score;
} a[N];
bool cmp(node a, node b)
{
    return a.x * b.d > a.d * b.x;
}
int main()
{
    ios::sync_with_stdio(false), cin.tie(0);
    cin >> n;
    for (int i = 1; i <= n; i++)
    {
        string s;
        cin >> s;
        ll x = 0, d = 0, score = 0;
        for (char c : s)
        {
            if (c == 'X')
                x++;
            else if (isdigit(c))
            {
                d += c - '0';
                score += (c - '0') * x;
            }
        }
        a[i] = {x, d, score};
    }
    sort(a + 1, a + n + 1, cmp);
    ll sumx = 0, ans = 0;
    for (int i = 1; i <= n; i++)
    {
        ans += a[i].d * sumx + a[i].score;
        sumx += a[i].x;
    }   
    cout << ans;
    return 0;
}
```


___


## é‡è¦äºŒåˆ†å‡½æ•°

`lower_bound`å’Œ`upper_bound`ã€‚

- `lower_bound` è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ª $\ge x$ çš„å…ƒç´ çš„ä½ç½®
- `upper_bound` è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ª $\gt x$ çš„å…ƒç´ ä½ç½®

ç”¨æ³•ï¼š

```cpp
int pos = lower_bound(a, a + n, x) - a; // å‡å»æ•°ç»„åæ‰èƒ½å¾—åˆ°ä¸‹æ ‡
if (pos == n) 
    cout << "-1"; // è¯´æ˜ä¸å­˜åœ¨å¤§äºæˆ–ç­‰äº x çš„å…ƒç´ 
else 
    cout << a[pos];

pos = lower_bound(a + 1, a + n + 1, x) - a; // upper_bound
if (pos == n + 1) 
    cout << "-1"; // è¯´æ˜ä¸å­˜åœ¨å¤§äºæˆ–ç­‰äº x çš„å…ƒç´ 
else 
    cout << a[pos];
```

___

## å®æ•°äºŒåˆ†

å®æ•°äºŒåˆ†å¸¸ç”¨äºæ±‚è§£æ•°å€¼é—®é¢˜ï¼Œä¾‹å¦‚æ±‚ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹ã€ç«‹æ–¹æ ¹ï¼Œæˆ–åœ¨å®æ•°èŒƒå›´å†…è¿›è¡Œâ€œäºŒåˆ†ç­”æ¡ˆâ€çš„é—®é¢˜ã€‚


ä¸æ•´æ•°äºŒåˆ†ç›¸æ¯”ï¼Œ**å®æ•°äºŒåˆ†çš„åŒºåˆ«ä»…åœ¨äºä½¿ç”¨ double ç±»å‹**ï¼Œå¹¶ä½¿ç”¨ç²¾åº¦æ§åˆ¶ç»“æŸæ¡ä»¶ã€‚

**é—®é¢˜ï¼š** ç”±äºæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­é‡‡ç”¨äºŒè¿›åˆ¶è¿‘ä¼¼å­˜å‚¨ï¼Œå¾ˆå¤šå®æ•°æ— æ³•è¢«ç²¾ç¡®è¡¨ç¤ºï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨`==` åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰å¯èƒ½å‡ºç°è¯¯å·®ã€‚

å› æ­¤ï¼Œ**åœ¨å®æ•°äºŒåˆ†ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç²¾åº¦æ§åˆ¶ç»“æŸæ¡ä»¶**ï¼Œå³åˆ¤æ–­ä¸¤ä¸ªå®æ•°ä¹‹é—´çš„è·ç¦»æ˜¯å¦å°äºæŸä¸ªé˜ˆå€¼ã€‚


___

### å†™æ³•

é€šå¸¸è®¾å®šä¸€ä¸ªå¾ˆå°çš„æ­£æ•° $\varepsilon$ï¼Œå½“å·¦å³è¾¹ç•Œç›¸å·®å°äº $\varepsilon$ æ—¶ï¼Œå°±è®¤ä¸ºå·²ç»â€œè¶³å¤Ÿç²¾ç¡®â€ã€‚

ä¾‹å¦‚ï¼š`while (l + eps < r)`ã€‚è®¾ç½® `constexpr double eps = 1e-6` è¿™æ ·çš„å°æ•°å­—ã€‚


___


#### ä¾‹é¢˜ä¸€ï¼šæ•°çš„ä¸‰æ¬¡æ–¹æ ¹

æœ¬é¢˜è¦æ±‚æ±‚å‡ºä¸€ä¸ªå®æ•° $x$ï¼Œä½¿å¾— $x^3 = n$ã€‚

é¦–å…ˆè¦ç¡®è®¤èƒ½å¦ä½¿ç”¨äºŒåˆ†ã€‚ç”±äºç«‹æ–¹å‡½æ•° $f(x) = x^3$ æ˜¯ä¸¥æ ¼å•è°ƒé€’å¢çš„ï¼ˆå³ $x$ å¢å¤§æ—¶ $x^3$ ä¹Ÿä¸€å®šå¢å¤§ï¼‰ï¼Œ**æ»¡è¶³å•è°ƒæ€§æ¡ä»¶**ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•æ¥æ±‚è§£ã€‚



- è®¾å®šä¸€ä¸ªè¶³å¤Ÿå¤§çš„æŸ¥æ‰¾åŒºé—´ï¼Œä¾‹å¦‚ $l = -100$, $r = 100$ã€‚
- æ¯æ¬¡å–ä¸­ç‚¹ï¼š$mid = \frac{l + r}{2}$ï¼Œç„¶åæ¯”è¾ƒ $mid^3$ å’Œ $n$ çš„å¤§å°å…³ç³»ï¼š
    - å¦‚æœ $mid^3 \geq n$ï¼Œè¯´æ˜ç­”æ¡ˆå¯èƒ½åœ¨å·¦è¾¹ï¼Œè®¾ $r = mid$
    - å¦‚æœ $mid^3 < n$ï¼Œè¯´æ˜ç­”æ¡ˆåœ¨å³è¾¹ï¼Œè®¾ $l = mid$

æ³¨æ„ï¼šç”±äºæ˜¯å®æ•°äºŒåˆ†ï¼Œ**ä¸è¦å†ä½¿ç”¨ `+1` æˆ– `-1` æ¥æ”¶ç¼©è¾¹ç•Œ**ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ª $\varepsilon$ æ§åˆ¶ç²¾åº¦ï¼Œå¦‚ $1e-8$ã€‚

```cpp
double l = -100, r = 100;
while (l + eps < r)
{
    double mid = (l + r) / 2;
    if (mid * mid * mid > n) 
        ans = mid, r = mid;
    else 
        l = mid;
}
printf("%.6lf", ans);
```


___


#### ä¾‹é¢˜äºŒï¼šåŒ…è£¹å¿«é€’


**é¢˜æ„ï¼š** å° K éœ€ä¾æ¬¡é€ $n$ ä¸ªåŒ…è£¹ï¼Œæ¯ä¸ªåœ°ç‚¹æœ‰ä¸€ä¸ªå¯ç­¾æ”¶æ—¶é—´æ®µ $[x_i, y_i]$ã€‚

æ¯ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´æœ‰è·ç¦» $s_i$ï¼Œè½¦é€Ÿä¸º $v$ï¼ŒK å¯ä»¥æå‰åˆ°è¾¾å¹¶ç­‰å¾…ï¼Œä½†ä¸èƒ½è¿Ÿåˆ°ã€‚

ç›®æ ‡ï¼šæ±‚æ»¡è¶³é€è¾¾æ‰€æœ‰åŒ…è£¹çš„å‰æä¸‹ï¼Œè½¦çš„æœ€å°æœ€å¤§é€Ÿåº¦ $v$


**è§‚å¯Ÿï¼š** é€Ÿåº¦è¶Šå¿«è¶Šå®¹æ˜“æ»¡è¶³é€è¾¾æ¡ä»¶ï¼Œå…·å¤‡å•è°ƒæ€§ è€ƒè™‘äºŒåˆ†é€Ÿåº¦ $v$ã€‚


**è¾¹ç•Œè®¾ç½®ï¼š** 

- $l = \varepsilon$ï¼Œå¦‚ $1e^{-6}$ï¼ˆé¿å…é™¤ä»¥ 0ï¼‰
- $r = 1e7$ï¼ˆè¶³å¤Ÿå¤§çš„é€Ÿåº¦ï¼‰


**Check å‡½æ•°è®¾è®¡**

`bool check(double v)`ï¼šåˆ¤æ–­å½“å‰é€Ÿåº¦ $v$ æ˜¯å¦èƒ½åœ¨æ‰€æœ‰åœ°ç‚¹æŒ‰æ—¶é€è¾¾ã€‚

è®¾å½“å‰æ—¶é—´ä¸º $now$ï¼Œåˆå§‹ä¸º $0$ï¼Œä¾æ¬¡éå†æ¯ä¸ªåŒ…è£¹ï¼š

- è®¡ç®—åˆ°è¾¾æ—¶é—´ï¼š$now + \frac{s_i}{v}$
- è‹¥è¶…å‡º $[x_i, y_i]$ èŒƒå›´ï¼ˆå³è¶…è¿‡ $y_i$ï¼‰ â†’ ä¸åˆæ³•
- è‹¥æ—©äº $x_i$ï¼Œéœ€ç­‰å¾…ï¼š$now = x_i$
- å¦åˆ™ï¼šæ­£å¸¸é€è¾¾ï¼Œæ›´æ–° $now = now + \frac{s_i}{v}$


**æ³¨æ„ï¼š** æœ¬é¢˜å¡ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨ `long double` ç±»å‹ã€‚


```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
const int N = 2e5 + 5;
const double eps = 1e-6;
int n;
long double x[N], y[N], s[N];
bool check(long double v)
{
    long double now = 0; // å½“å‰æ—¶é—´åˆå§‹ä¸º 0
    for (int i = 1; i <= n; i++)
    {
        double t = s[i] / v; // è®¡ç®—èµ°è¿‡å»çš„æ—¶é—´
        if (now + t > y[i]) return false;
        else if (now + t < x[i])
        {
            now = x[i]; // å½“å‰åˆ°è¾¾æ—¶é—´æ˜¯ x[i]
        }
        else
        {
            now = now + t;
        }
    }
    return true;
}
int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cin >> n;
    for (int i = 1; i <= n; i++) cin >> x[i] >> y[i] >> s[i];
    long double l = 0, r = 1e7, ans;
    while (l + eps < r)
    {
        long double mid = (l + r) / 2;
        if (check(mid)) ans = mid, r = mid;
        else l = mid;
    }
    cout << fixed << setprecision(2) << ans;
    return 0;
}
```


___

### æœºå™¨äººçš„æƒ…æ„Ÿ

æœ¬é¢˜å±äºä¸­ä½æ•°å¸¸è§çš„äºŒåˆ†å¥—è·¯ã€‚äºŒåˆ†ä¸­ä½æ•° $x$ã€‚

å¯¹äºæ•´ä¸ªåºåˆ—ï¼Œå°†å¤§äºç­‰äº $x$ çœ‹ä½œæ˜¯ $1$ï¼Œå°äº $x$ çœ‹ä½œæ˜¯ $-1$ã€‚

è‹¥å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåŒºé—´ï¼Œä¸”åŒºé—´å’Œä¸º $0$ï¼Œè¯´æ˜è¯¥åŒºé—´ä¸­ä½æ•°å¤§äºç­‰äº $x$ã€‚


åŒºé—´å’Œå¯ä»¥ç”¨å‰ç¼€å’Œé«˜æ•ˆå¤„ç†ï¼Œä½†æšä¸¾åŒºé—´æ˜¾ç„¶ä¼š TLEã€‚è®©æˆ‘ä»¬è¿™æ ·å®¡è§†ä»¥ä¸‹é—®é¢˜ï¼š

å½“äºŒåˆ†ä¸­ä½æ•° $x$ ä»¥åï¼Œå³æ‰¾åˆ°ä¸€ä¸ªåŒºé—´ $[i,j]$ ä½¿å¾—ï¼š

$$\begin{cases}
j-i+1\geq L\\
sum_j-sum_{i-1}\geq 0
\end{cases}$$

æšä¸¾ $j$ï¼Œç»´æŠ¤å‰ç¼€æœ€å°å€¼ $sum_{i-1}$ è®°ä½œ $mn$ã€‚è‹¥ $sum_j-mn\geq 0$ï¼Œåˆ™å­˜åœ¨ä¸€ä¸ªåŒºé—´ã€‚ä¸ºäº†ä¿è¯åŒºé—´é•¿åº¦ã€‚ $j$ å¿…é¡»ä» $L$ å¼€å§‹æšä¸¾ã€‚


```cpp
bool check(int x)
{
    vector<int> sum(n + 1);
    for (int i = 1; i <= n; i++)
        if (a[i] >= x)
            sum[i] = sum[i - 1] + 1;
        else 
            sum[i] = sum[i - 1] - 1;
    int mn = 1e9;
    for (int j = L; j <= n; j++)
    {
        mn = min(mn, sum[j - L]);
        if (sum[j] - mn >= 0) return true;
    }
}
```

___

### ä¾‹é¢˜å››ï¼š[NOIP2011 æé«˜ç»„]èªæ˜çš„è´¨ç›‘å‘˜


å¯¹äºä¸€ä¸ªåŒºé—´ $[l_i,r_i]$ æ¥è¯´ï¼Œæ£€éªŒå€¼ $y_i$

$$
y_i=\sum\limits_{j=l_i}^{r_i}[w_j \ge W] \times \sum\limits_{j=l_i}^{r_i}[w_j \ge W]v_j
$$

æ­¤å¼å­æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šåŒºé—´å†…å¤§äºç­‰äº $W$ çš„ä¸ªæ•°ä¹˜ä»¥å¤§äºç­‰äº $W$ çš„ $w$ ä¹‹å’Œã€‚


éšç€ $W$ çš„å¢å¤§ï¼Œ$y_i$ å¿…ç„¶å‡å°ã€‚é‚£ä¹ˆ $\sum y_i$ ä¹Ÿåœ¨å‡å°ã€‚å› æ­¤ $W$ å…·å¤‡å•è°ƒæ€§å­˜åœ¨ä¸€ä¸ªä¸´ç•Œå€¼ä½¿å¾—å…¶å’Œ $|s-\sum y_i|$ æœ€å°ã€‚

å› æ­¤äºŒåˆ† $W$ å°è¯•æ‰¾åˆ°æœ€æ¥è¿‘ $s$ çš„ $\sum {y_i}$ã€‚



ğŸ› ï¸ **äºŒåˆ†è§£æ³•æ•´ä½“æµç¨‹**


**1. äºŒåˆ†æŸ¥æ‰¾ï¼š**

æˆ‘ä»¬è®¾å®šæœç´¢èŒƒå›´ï¼š

* $W \in [1, 10^6]$ï¼Œå› ä¸ºçŸ¿çŸ³é‡é‡æœ€å¤§æ˜¯ $10^6$

æ¯æ¬¡äºŒåˆ†ä¸€ä¸ªä¸­å€¼ $W_{\text{mid}}$ï¼Œç„¶åï¼š

* é¢„å¤„ç†æ»¡è¶³ $w_i \ge W_{\text{mid}}$ çš„ä¸ªæ•°ä»¥åŠå‰ç¼€å’Œã€‚
    * é€šè¿‡å‰ç¼€å’Œ $O(1)$ çš„æ—¶é—´æ±‚å‡º $y_i$ã€‚
* å¯¹æ¯ä¸ªåŒºé—´ï¼Œè®¡ç®— count å’Œ sum
* å¾—åˆ°å½“å‰ $y(W_{\text{mid}})$ï¼Œå’Œ $s$ æ¯”è¾ƒå¤§å°ï¼Œæ›´æ–°æœ€å° $|y - s|$

---



```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

int n, m;
ll s;
vector<int> w, v;
vector<pair<int, int>> ranges;

ll calc_y(int W) 
{
    vector<int> cnt(n + 1, 0);
    vector<ll> sum(n + 1, 0);

    for (int i = 1; i <= n; ++i) 
    {
        cnt[i] = cnt[i - 1] + (w[i] >= W ? 1 : 0);
        sum[i] = sum[i - 1] + (w[i] >= W ? v[i] : 0);
    }

    ll y = 0;
    for (auto [l, r] : ranges) 
    {
        int c = cnt[r] - cnt[l - 1];
        ll s = sum[r] - sum[l - 1];
        y += c * s;
    }
    return y;
}

int main() 
{
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    cin >> n >> m >> s;
    w.assign(n + 1, 0);
    v.assign(n + 1, 0);
    for (int i = 1; i <= n; ++i) 
    {
        cin >> w[i] >> v[i];
    }
    ranges.assign(m, {});
    for (int i = 0; i < m; ++i) 
    {
        cin >> ranges[i].first >> ranges[i].second;
    }

    int L = 1, R = 1e6;
    ll ans = LLONG_MAX;

    while (L <= R) 
    {
        int mid = (L + R) / 2;
        ll y = calc_y(mid);
        ans = min(ans, abs(y - s));

        if (y > s) 
        {
            L = mid + 1;
        } 
        else 
        {
            R = mid - 1;
        }
    }

    cout << ans << '\n';
}
```







