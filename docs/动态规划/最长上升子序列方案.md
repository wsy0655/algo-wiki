

---

### ğŸ“˜ é¢˜æ„

ç»™å‡ºä¸€ä¸ªç”± $n(n \le 2 \cdot 10^5)$ ä¸ªä¸è¶…è¿‡ $10^9$ çš„æ­£æ•´æ•°ç»„æˆçš„åºåˆ—ã€‚è¯·è¾“å‡ºè¯¥åºåˆ—çš„ï¼š

- **æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦**
- **æ„é€ å‡ºä¸€ç»„åˆæ³•çš„ LIS**

---

### ğŸ§ª 60 åˆ†åšæ³•ï¼ˆæœ´ç´ ç‰ˆï¼‰

è¯¥æ–¹æ³•ä½¿ç”¨ $O(n^2)$ çš„ DP æ„é€ è·¯å¾„ï¼Œä»…é€‚ç”¨äºæ•°æ®è§„æ¨¡è¾ƒå°çš„æƒ…å†µã€‚

**ğŸ’¡ è§£é¢˜æ€è·¯**

- ä»¤ `f[i]` è¡¨ç¤ºä»¥ç¬¬ `i` ä¸ªå…ƒç´ ç»“å°¾çš„ LIS é•¿åº¦
- å®šä¹‰ `g[i]` è¡¨ç¤ºç¬¬ `i` ä¸ªä½ç½®æ˜¯ä»å“ªä¸ªä¸‹æ ‡è½¬ç§»æ¥çš„ï¼ˆè·¯å¾„è®°å½•ï¼‰
    - æ¯æ¬¡è½¬ç§»ä¸­ï¼Œå¦‚æœ `f[j] + 1 > f[i]` ä¸” `a[j] < a[i]`ï¼Œå°±æ›´æ–°ï¼š
      - `f[i] = f[j] + 1`
      - `g[i] = j`

**ç­”æ¡ˆæ„é€ **

- æ‰¾åˆ°æœ€é•¿é•¿åº¦ `ans`ï¼Œè®°å½•ä»»æ„ä¸€ä¸ª `f[i] == ans` çš„ä½ç½® `i`
- ä»è¯¥ä½ç½®ä¸æ–­å›æº¯ `i = g[i]`ï¼Œç›´åˆ°è·³åˆ°èµ·ç‚¹ä¸ºæ­¢
- æœ€åå°†è·¯å¾„ **åå‘è¾“å‡º** å³å¯

**â±ï¸å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---


**ç¤ºèŒƒä»£ç **


```cpp
for (int i = 1; i <= n; i++) 
{
    f[i] = 1;
    for (int j = 1; j < i; j++) 
    {
        if (a[i] > a[j]) 
        {
            if (f[j] + 1 > f[i])
            {
                g[i] = j; // i çš„ä¸Šä¸€ä¸ªç»“å°¾æ˜¯ j
                f[i] = f[j] + 1;
            }
        }
    }
    ans = max(ans, f[i]);
}
cout << ans << "\n";
int id = 0; // æ‰¾åˆ°ä¸€ä¸ªç»“å°¾å¼€å§‹é€†æ¨
for (int i = 1; i <= n; i++)
{
    if (f[i] == ans)
    {
        id = i; // éšä¾¿å“ªä¸ªéƒ½è¡Œ
    }
}
vector<int> ans;
for (int i = id; i >= 1; i = g[i]) // ç±»ä¼¼äºé“¾è¡¨å‘å‰è·³ä¸Šä¸€ä¸ªç»“å°¾
{
    ans.push_back(a[i]);
}
reverse(ans.begin(), ans.end());
for (auto x : ans) cout << x << " ";
```


---


### ğŸ¥‡ 100 åˆ†åšæ³•ï¼ˆäºŒåˆ†ä¼˜åŒ–ç‰ˆï¼‰

åœ¨ $O(n \log n)$ çš„ LIS è§£æ³•ä¸­ï¼Œå¢åŠ è·¯å¾„è¿½è¸ªå³å¯å®ç°æ„é€ ã€‚

**ğŸ’¡ æ ¸å¿ƒæ€è·¯**

åˆ©ç”¨è¾…åŠ©æ•°ç»„ `d[]` æ¥ç»´æŠ¤ä¸åŒé•¿åº¦çš„ä¸Šå‡å­åºåˆ—ç»“å°¾ï¼ŒåŒæ—¶è®°å½•è·¯å¾„æ¥æºï¼Œå®ç° LIS çš„åŒæ—¶æ„é€ è·¯å¾„ã€‚

---

**å‡†å¤‡å·¥ä½œ**

- å®šä¹‰ `pair<int, int> d[N]`ï¼š  
    - `d[i].first`ï¼šé•¿åº¦ä¸º `i` çš„ LIS çš„æœ€å°ç»“å°¾å€¼  
    - `d[i].second`ï¼šè¿™ä¸ªå€¼å¯¹åº”çš„åŸæ•°ç»„ä¸‹æ ‡ï¼ˆç”¨äºè·¯å¾„å›æº¯ï¼‰

- å®šä¹‰ï¼š  
    - `g[i]`ï¼šè®°å½•å½“å‰ä½ç½®çš„è½¬ç§»æ¥æºï¼ˆæ¥è‡ªå“ªä¸ªä¸‹æ ‡ï¼‰  
    - `f[i]`ï¼šä»¥ `i` ä¸ºç»“å°¾çš„ LIS é•¿åº¦  
    - `len`ï¼šå½“å‰ LIS çš„æœ€å¤§é•¿åº¦

---

**æµç¨‹å®ç°**

éå†æ¯ä¸ªå…ƒç´  `a[i]`ï¼Œå¯¹ LIS çŠ¶æ€å’Œè·¯å¾„è¿›è¡Œæ›´æ–°ï¼š

- **è‹¥ `a[i] > d[len].first`**ï¼š  
  ğŸ‘‰ å¯ä»¥ä½œä¸ºé•¿åº¦ä¸º `len + 1` çš„ LIS ç»“å°¾  
    - `g[i] = d[len].second`ï¼ˆè®°å½•è½¬ç§»è·¯å¾„ï¼‰  
    - `d[++len] = {a[i], i}`  
    - `f[i] = len`

- **å¦åˆ™ï¼ˆäºŒåˆ†æŸ¥æ‰¾æ›´æ–°ä½ç½®ï¼‰**ï¼š  
  ğŸ‘‰ æ‰¾åˆ°æœ€æ—©ä¸€ä¸ª `d[pos].first >= a[i]` çš„ä½ç½®  
  `int pos = lower_bound(d + 1, d + len + 1, pair<int, int>(a[i], 0)) - d;`

    - `g[i] = d[pos - 1].second`ï¼ˆä¸Šä¸€ä¸ªé•¿åº¦ä¸º $pos - 1$ çš„ç»“å°¾ï¼‰
    - `d[pos] = {a[i], i}`ï¼ˆæ›´æ–°è¯¥ä½ç½®çš„ç»“å°¾å€¼ï¼‰
    - `f[i] = pos`

**ç­”æ¡ˆæ„é€ **

- åœ¨æ‰€æœ‰ä½ç½®ä¸­æ‰¾åˆ° `f[i] == len` çš„ä»»æ„ä¸‹æ ‡ $i$
- ä» $i$ å¼€å§‹ï¼Œæ ¹æ® `g[i]` é€æ­¥å›æº¯
- æ”¶é›†è·¯å¾„å¹¶å€’åºè¾“å‡º

**â±ï¸ å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$ï¼ˆLIS + äºŒåˆ†ï¼‰

- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ï¼ˆè·¯å¾„è®°å½• + çŠ¶æ€ï¼‰

**ä»£ç **

```cpp
#include <bits/stdc++.h>
using namespace std;
constexpr int N = 2e5 + 5;
int n, a[N], len, g[N], f[N];
pair<int, int> d[N];
int main()
{
    ios::sync_with_stdio(false), cin.tie(0);
    cin >> n;
    for (int i = 1; i <= n; i++)
    {
        cin >> a[i];
    }
    for (int i = 1; i <= n; i++)
    {
        if (a[i] > d[len].first)
        {
            g[i] = d[len].second; // é•¿ä¸º len çš„ LIS ç»“å°¾åœ¨ä¸‹æ ‡ i
            d[++len] = {a[i], i};
            f[i] = len;
        }
        else
        {
            int pos = lower_bound(d + 1, d + len + 1, pair<int, int>(a[i], 0)) - d;
            g[i] = d[pos - 1].second;
            d[pos] = {a[i], i};
            f[i] = pos;
        }
    }
    cout << len << "\n";
    vector<int> ans;
    int id = 0;
    for (int i = 1; i <= n; i++)
    {
        if (f[i] == len)
        {
            id = i;
        }
    }
    for (int i = id; i >= 1; i = g[i])
    {
        ans.push_back(a[i]);
    }
    reverse(ans.begin(), ans.end());
    for (auto x : ans) cout << x << " "; 
    return 0;
}
```